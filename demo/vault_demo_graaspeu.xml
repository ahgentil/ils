<Module>
    <ModulePrefs title="Vault Demo"
        author_email="mariarodrigueztriana@epfl.ch"
        author="Maria Jesus Rodriguez Triana" 
        description="Shows how to use the new ils javascript library"
        width="500"
        height="800">
        <Require feature="opensocial" />
        <Require feature="osapi" />
    </ModulePrefs>
    <Content type="html" view="default,canvas,home,profile">
        <![CDATA[
            <script type="text/javascript" src="http://graasp.epfl.ch/gadget/libs/jquery-1.8.0.min.js"></script>
            <script type="text/javascript" src="http://graasp.epfl.ch/gadget/libs/jquery.cookie.js"></script>
            <script type="text/javascript" src="http://graasp.epfl.ch/ils_lib/main/ils_graaspeu.js"></script>
            
            <script type="text/javascript">
            
            var getData = function() {

            // get current user and print it
            ils.getCurrentUser(function(current_user){
            console.log("Printing current user");
            console.log(current_user);
            $('#get_current_user').append("Current user nickname: " + current_user);
            });

            // get the ILS and print it
            ils.getIls(function(ils_space){
            console.log("Printing ils");
            console.log(ils_space);
            $('#get_ils').append("ILS id " + ils_space.id);
            });

            // get the Vault space and print it
            ils.getVault(function(vault){
            console.log("Printing vault");
            console.log(vault);
            $('#get_vault').append("Vault id " + vault.id);
            });

            // get all resources in the Vault
            ils.listVault(function(resources){
            console.log("Printing resources in the Vault");
            console.log(resources);
            $.each(resources, function(index, value) {
            $('#list_vault').append("<div>" + value.id + " " + value.displayName + "</div>");
            });
            });

            // read a non-existent resource in the Vault
            ils.readResource("5456c9900c3acd201d083a70", function(resource){
            console.log("Trying to read a non existent resource in Vault");
            console.log(resource);
            $('#read_resource_1').append("Resource id and name: " + resource.id + " " + resource.displayName);
            });

            // read an exising resource in the Vault
            ils.readResource("54590fada3709c8b88fcb7da", function(resource){
            console.log("Read an existent resource in Vault");
            console.log(resource);
            $('#read_resource_2').append("Resource id and name: " + resource.id + " " + resource.displayName);
            });

            // get parent space
            ils.getParent(function(parent){
            console.log("Printing parent");
            console.log(parent);
            $('#get_parent').append("Parent id and name: " + parent.id + " " + parent.displayName);
            });

            // get parent inquiry phase
            ils.getParentInquiryPhase(function(phase){
            console.log("Printing parent phase");
            console.log(phase);
            $('#get_parent_phase').append(phase);
            });

            var example_content = {
              "concepts": [
                {"x": 297,
                 "y": 188,
                 "content": "energy",
                 "id": "7f800d79-cd66-2167-724c-6c1cda7abc5e",
                 "type": "ut_tools_conceptmapper_conceptSelector",
                 "colorClass": "ut_tools_conceptmapper_blue"},

                {"x": 652,
                 "y": 238,
                 "content": "thermodynamic temperature",
                 "id": "a1ad6ace-c722-ffa9-f58e-b4169acdb4e3",
                 "type": "ut_tools_conceptmapper_conceptSelector",
                 "colorClass": "ut_tools_conceptmapper_blue"}],

              "relations": [
                {"source": "7f800d79-cd66-2167-724c-6c1cda7abc5e",
                "target": "a1ad6ace-c722-ffa9-f58e-b4169acdb4e3",
                "id": "con_71",
                "content": "influences"}]
            };

            // create a resource in the Vault
            ils.createResource("test", example_content, "", function(resource){
            console.log("Creating a resource in the Vault folder");
            console.log(resource);
            $('#create_resource').append("New resource id: " + resource.id);
            });

            // checks if a non-existent resource exist
            ils.existResource("5456c9900c3acd201d083a70", function(response){
            console.log("Checking existence of a removed resource");
            $('#exist_resource_1').append("Resource 5456c9900c3acd201d083a70 exists? " + response);
            });

            // checks if a resource exist
            ils.existResource("54590fada3709c8b88fcb7da", function(response){
            console.log("Checking whether a resource exists");
            $('#exist_resource_2').append("Resource 54590fada3709c8b88fcb7da exists? " + response);
            });

            // obtains a metadata from a resource
            ils.getMetadata("54590fada3709c8b88fcb7da", function(metadata){
            console.log("Getting metadata from resource");
            console.log(metadata);
            $('#get_metadata').append("Metadata from 54590fada3709c8b88fcb7da: "+ metadata);
            });

            // deletes a resource
            ils.deleteResource("5456c9900c3acd201d083a70", function(response){
            console.log("Trying to delete a non existent resource");
            $('#delete_resource_1').append("Resource 5456c9900c3acd201d083a70 deleted? " + response.error);
            });

            // deletes a resource
            ils.deleteResource("54590f66a3709c8b88fcb792", function(response){
            console.log("Deleting an existent resource");
            $('#delete_resource_2').append("Resource 54590f66a3709c8b88fcb792 deleted? " + response);
            });
            
            var example_content_2 = {
            "concepts": [
                {"x": 200,
                "y": 100,
                "content": "power",
                "id": "7f800d79-cd66-2167-724c-6c1cda7abc5f",
                "type": "ut_tools_conceptmapper_conceptSelector",
                "colorClass": "ut_tools_conceptmapper_blue"},

                {"x": 600,
                "y": 200,
                "content": "speed",
                "id": "a1ad6ace-c722-ffa9-f58e-b4169acdb4e4",
                "type": "ut_tools_conceptmapper_conceptSelector",
                "colorClass": "ut_tools_conceptmapper_blue"}],

            "relations": [
                {"source": "7f800d79-cd66-2167-724c-6c1cda7abc5f",
                "target": "a1ad6ace-c722-ffa9-f58e-b4169acdb4e4",
                "id": "con_72",
                "content": "influences"}]
            };

            // updates a resource
            ils.updateResource("54567c420c3acd201d083865", example_content_2, "", function(response){
            console.log("Updating an existent resource");
            console.log(response);
            $('#update_resource').append("Resource 54567c420c3acd201d083865 updated? " + response.id);
            });
            
        }

  console.log(gadgets);
  gadgets.util.registerOnLoadHandler(getData);

  </script>
  <div id="get_current_user"><b>ils.getCurrentUser:</b> </div>
  <div id="get_ils"><b>ils.getIls:</b> </div>
  <div id="get_vault"><b>ils.getVault:</b> </div>
  <div id="list_vault"><b>ils.listVault:</b> </div>
  <div id="read_resource_1"><b>ils.readResource(nonexistent):</b> </div>
  <div id="read_resource_2"><b>ils.readResource(existent):</b> </div>
  <div id="get_parent"><b>ils.getParent:</b> </div>
  <div id="get_parent_phase"><b>ils.getParentInquiryPhase:</b> </div>
  <div id="create_resource"><b>ils.createResource:</b> </div>
  <div id="exist_resource_1"><b>ils.existResource(nonexistent):</b> </div>
  <div id="exist_resource_2"><b>ils.existResource(existent):</b> </div>
  <div id="get_metadata"><b>ils.getMetadata:</b> </div>
  <div id="delete_resource_1"><b>ils.deleteResource(nonexistent):</b> </div>
  <div id="delete_resource_2"><b>ils.deleteResource(existent):</b> </div>
  <div id="update_resource"><b>ils.updateResource:</b> </div>
  <br/>
  ]]>
  </Content>
</Module>
  
